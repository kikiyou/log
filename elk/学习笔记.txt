安装搜索引擎
//brew install elasticsearch
tar -zxvf elasticsearch-2.3.1.tar.gz
cd elasticsearch-2.3.1

安装head和bigdesk插件
./bin/plugin install mobz/elasticsearch-head

./bin/plugin install hlstudio/bigdesk

./bin/plugin install elastic/kibana



修改配置
vi config/elasticsearch.yml
修改配置项
cluster.name=es_cluster
node.name=node0
path.data=/tmp/elasticsearch/data
path.logs=/tmp/elasticsearch/logs
network.host=localhost
http.port=9200


启动
./bin/elasticsearch

curl -X GET 'http://localhost:9200'


http://localhost:9200/_plugin/head
http://localhost:9200/_plugin/bigdesk

登录集群和管理界面Marvel（收费的）
http://localhost:9200/_plugin/Marvel


安装日志分析工具
//brew install logstash
tar -zxvf logstash-2.3.1.tar.gz
cd logstash-2.3.1

mkdir config
vi config/log4j_to_es.conf

# For detail structure of this file
# Set: https://www.elastic.co/guide/en/logstash/current/configuration-file-structure.html
input {
  # For detail config for log4j as input, 
  # See: https://www.elastic.co/guide/en/logstash/current/plugins-inputs-log4j.html
  log4j {
    mode => "server"
    host => "localhost"
    port => 4567
  }
}
filter {
  #Only matched data are send to output.
}
output {
  # For detail config for elasticsearch as output, 
  # See: https://www.elastic.co/guide/en/logstash/current/plugins-outputs-elasticsearch.html
  elasticsearch {
    action => "index"            #The operation on ES
    hosts  => "localhost:9200"     #ElasticSearch host, can be array.
    index  => "ec"               #The index to write data to, can be any string.
  }
}


启动
./bin/logstash agent -f config/log4j_to_es.conf

安装数据显示客户端
//brew install kibana
tar -zxvf kibana-4.5.0-darwin-x64.tar.gz
cd kibana-4.5.0-darwin-x64


配置config/kibana.yml

server.host : "localhost"
server.post : 5601
elasticsearch.url : http://localhost:9200
kibana.index : ".kibana"

启动./bin/kibana
访问 http://localhost:5601 配置kibana


访问
http://localhost:9200/_plugin/kibana







log4j.properties
log4j.rootLogger=INFO,console
 
# for package com.demo.elk, log would be sent to socket appender.
log4j.logger.com.demo.elk=DEBUG, socket
 
# appender socket
log4j.appender.socket=org.apache.log4j.net.SocketAppender
log4j.appender.socket.Port=4567
log4j.appender.socket.RemoteHost=localhost
log4j.appender.socket.layout=org.apache.log4j.PatternLayout
log4j.appender.socket.layout.ConversionPattern=%d [%-5p] [%l] %m%n
log4j.appender.socket.ReconnectionDelay=10000
 
# appender console
log4j.appender.console=org.apache.log4j.ConsoleAppender
log4j.appender.console.target=System.out
log4j.appender.console.layout=org.apache.log4j.PatternLayout
log4j.appender.console.layout.ConversionPattern=%d [%-5p] [%l] %m%n








